## 对象基础

对象（Object）和类（Class）是本书的核心。随着 PHP5 发布，它们也成为了 PHP 的核心内容。在本章中，通过介绍 PHP 的核心面向对象特性奠定一些基础知识，以便后面深入分析对象与设计。

PHP5 在面向对象支持方面有了很大的进展，因此如果你已经熟悉了 PHP4，就可以在 PHP5 中发现一些新东西。如果你是初次接触面向对象程序设计，则需要仔细阅读本章。

本章包括如下内容。

- 类和对象：声明类和实例化对象。
- 构造方法：自动加载对象。
- 基本数据类型和类的类型：为什么类型很重要。
- 继承（inheritance）：为什么需要继承以及如何使用继承。
- 可见性（visibility）：整合对象接口并保护类中的方法和属性不受干涉。


#### 类和对象

理解面向对象程序设计的第一个障碍是类和对象之间奇妙的关系。对于许多人来说，这是它第一次接触这种关系，是和面向对象产生的第一缕火花，所以我们不会跳过基础知识。

#### 编写第一个类
我们经常用对象来描述类，有趣的是也经常用类来描述对象。这个循环使面向对象编程的第一步很难继续下去。因为类定义对象，所以我们首先来定义一个类。

简单地说，类是用于生成对象的模板。我们使用 `class` 关键字和一个任意的类名来声明类。类名可以是任意数字和字母的组合，但是不能以数字开头。和一个类关联的代码必须用大括号括起来。据此我们创建一个类：

```
class ShopProduct
{
    // 类体
}

```
例中的 ShopProduct 类已经是一个合法的类。虽然它没有任何用处，但是我们已经完成了一些非常重要的事情。我们定义了一个类型，即创造了一种可以在脚本中使用的数据。读完本章后，你就会明白它的作用。

#### 第一个对象（或两个）
如果类是生成对象的模板，那么对像是根据类中定义的模板所构造的数据。对象可以被说成类的 “实例”，它是类定义的数据类型。

我们使用 ShopProduct 类作为生成 ShopProduct 对象的模板。这样做只需要使用 new 操作符。new 操作符和类名一起使用，如下所示：

```
$product1 = new ShopProduct();
$product2 = new ShopProduct();
```
new 操作符和作为它唯一操作数的类名一起被调用，并生成类的实例。在本例中，它生成了一个 ShopProduct 对象。

我们使用了 ShopProdcut 类作为生成两个 ShopProduct 对象的模板。虽然它们的功能相同（都为空），但是 $product1 和 $product2 是由同一个类生成的相同类型的不同对象。

如果你还不明白，那么打个比方:把类当做生产塑料鸭子的机器的一个铸模，那么对象就是这台机器生产的鸭子。物品的类型由把它们压制出来的模具决定的。它们看起来都是一样的，但是它们是不同的个体。也就是说，它们是同一类型的不同实例。这些鸭子可能有它们自己的序列号来说明它们的身份，在 PHP 脚本中创建的每个对象也有唯一的身份（在对象的生命周期中唯一），也就是说，PHP 会在一个进程内重复使用这些身份（或标识符，identifier）来访问这些对象。可以通过输出 $product1 和 $product2 对象来证明这一点。

```
var_dump($product1);
var_dump($product2);
```
执行这两个函数后，得到的输出如下：
```
object(pop\cho3\batch01\ShopProduct)#235 (0) {
    
}

object(pop\cho3\batch01\ShopProduct)#234 (0) {
    
}
```
> 注解：在 PHP4 和 PHP5 （直到版本 5.1）中，直接输出一个对象，得到的是包含对象 ID 的字符串。从 PHP5.2 起，PHP 不再支持这个功能，把对象当做字符串处理将会出错。除非在对象的类中定义了 __toString() 方法。在本章后面会用到这个方法，并且在第 4 章中也会介绍 __toString()。

通过传递对像的给 var_dump()，我们获得了所包含的有用信息——每个对象的内部标志符（#号后面的数字）。
要使对象更加有趣，可以修改 ShopProduct 类以支持特定的数据字段——属性（property）。

#### 设置类中的属性

类可以定义被称为属性的特定变量。属性也被称为成员变量，用来存放对象之间互不相同的数据。例如：在 ShopProduct 对象的例子中，我们可以用类属性来指定商品名称和价格。

类的属性和标准的变量很相似，不过必须在声明和赋值前加一个代表可见性的关键字（keyword）。这个关键字可以是 public、protected、private，它决定了属性的作用域。

> 注解：变量作用域是指变量在函数或类中有意义的区域（它和类方法的作用域概念相同，这将在本章后面讨论）。因此，在函数内定义的变量存在于局部作用域（local scope）中，在函数之外定义的变量则存在于全局作用域（global scope）中。通常来说，我们无法从外部访问定义于内部作用域的变量。因此，如果将变量定义在函数内部，就不能从函数外部访问它。但对象则要宽松些，某些对象中的变量有时可以从其他地方访问。我们都会看到，哪些变量可以被访问以及可以从哪里访问是由 public、protected 和 private 关键字决定的。

本章稍后将回到这些关键字和可见性的问题上。现在，让我们用 public 关键字来声明属性：

```
class ShopProduct
{
    public $title = "default product";
    public $producerMainName = "main name";
    public $producerFirstName = "first name";
    public $price = 0;
}
```
如上所示，我们设置了 4 个属性，并且给每个属性赋了初始值。实例化的 ShopProduct 类得到的任何对象都将加载默认数据。每个属性声明中的 public 关键字确保我们可以从对象之外访问属性。

> 注解：可见性关键字 public、private、protected 是在 PHP5 引入的。如果在 PHP4 下运行，这些例子将无法正常工作。在 PHP4 中，所有的属性都用 var 关键字声明的，它的效果和使用 public 一样。以为考虑到向后兼容，PHP5 中保留了对 var 的支持，但会将 var 自动转换为 public。

我们可以使用 `->` 字符连接对象和属性名来访问属性变量，如下所示：

```
$product1 = new ShopProduct();
print $product1->title;   // default product
```
因为属性定义为 public，所以可以给属性赋值（也可以读取属性），替换其在类中设置的默认值。

```
$product1 = new ShopProduct();
$product2 = new ShopProduct();
$product1->title = "My Antonia";
$product2->title = "Catch 22";
```
通过在 ShopProduct 类中声明和设置 $title 属性，可以确保所有的 ShopProduct 对象在初次创建时都有此属性。这就意味着使用这个类的代码在此假定上可以使用这个 ShopProduct 对象。因为可以重设这一属性，所以不同对象的 $title 值都可不同。

> 注解：调用类、函数或方法的代码通常被称为该类、函数或方法的客户端（client）或者客户端代码（client code），在后面的章节中将会频繁看到这个术语。 