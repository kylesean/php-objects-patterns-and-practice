对象一开始并不是 PHP 项目的关键，它是 PHP 创建者们后来才想要到要引进的。

引进对象的想法被证明是非常正确的。本章总结了 PHP 面向对象特性的发展过程，逐步介绍对象的概念。本章包括以下内容：
- PHP/FI 2.0：我们所不知道的 PHP。
- PHP 3：对象的首次出现。 
- PHP 4: 面向对象编程的发展。
- PHP 5：对象成为 PHP 的核心部分。
- PHP 7：缩小差距，提升性能

### PHP 对象的偶然成功
很对面向对象风格的 PHP 类库和程序在广泛流传，说明了对象对于 PHP 的重要性。PHP5 对于面向对象开发的加强，看上去像一个自然和不可避免的结果。实际上，事实并非如此。

#### 最初：PHP/FI
正如我们今天知道的那样，PHP 起源于 `Rasmus Lerdorf` 用 Perl 开发的工具。PHP 是 `Personal Homepage Tool` 的简写，意为“个人主页工具”，而 FI 即 `Form Interpreter`，意为“表单解释器”。结合这两种工具形成的宏命令可用来发送 SQL 语句到数据库、处理表单和流控制。

这两个工具用 C 语言重写后组成了 PHP/FI 2.0。这个时期的 PHP 看上去和现在的语法不太一样，但本质上没有太大的不同。它支持变量、关联数组和函数。当然，那时还没有对象。

#### 语法糖：PHP 3
事实上，在 PHP3 的计划阶段，对象并不安排之中。和今天的 PHP 一样，PHP3的主要架构设计师也是 `Zeev Suraski` 和 `Andi Gutmans`。PHP3 是由 PHP/FI 2.0 完全重写的，但是对象并不是新语法中必需的部分。

据 `Zeev Suraski` 回忆，PHP 对类的支持实际上是后来才进去的（准确地说是 1997 年 8 月 27 日）。那时的类和对象实际上是定义和存取关联数组的另一种方式。

当然，加入了方法和继承使得类比关联数组更加强大，但那时对类的操作仍然存在很多局限性，比如不能访问父类中被覆盖的方法（如果你不明白这里的意思也不用担心，我们将在后面解释）。另一个不足之处是对象在 PHP 脚本中被传递的方式并非最佳，我们马上就会讲到。
在这个时期对象只是边缘话题，在官方文档中也没有提及这方面内容。PHP 手册只用了一句话和一段代码示例来介绍对象，而且该示例没有介绍对象的继承和属性等。

#### 一场静悄悄的革命
PHP4 可算是夯实 PHP 基础的另一个阶段，因此此时 PHP 大部分核心代码都被重写了。Zend 引擎（由 Zeev 和 Andi 而得名）开始为 PHP 提供强大动力。Zend 引擎是 PHP 的主要组成部分之一。任何你可能调用到的 PHP 函数都是高级扩展层的一部分，它们一般都是根据所完成的工作来命名的，比如和数据库 API 对话或者转换字符串。Zend 引擎管理内存，将控制交由其他组件，并将我们所熟知的每天使用的 PHP 语法转换为可执行的字节码（bytecode），而且类也是由 Zend 引擎引入 PHP 的核心特性。

客观地说，在 PHP4 中，我们可以在子类中覆盖并访问父类的方法，这是一个很大的进步。
然而主要的不足依然存在。把对象赋值给变量，传递对象到函数，或从方法返回对象，结果都会创建对象的副本。所以这样的赋值：
```
$my_obj = new User('bob');
$other = $my_obj;
```
将导致同时存在两个 User 对象，而不是同一个 User 对象的两个引用。在大多数面向对象语言中，我们一直都是按引用传递对象，而不是像这里这样按值传递。也就是说，只传递指向对象的引用，而不是对象的副本。默认按值传送的行为导致了很多不明显的 bug，因为程序员可能会无意识地在脚本的某个部分修改了对象，而希望在其他的引用上看到了改变（实际上在其他引用上却没有任何改变）。在本书中，我们将看到很多对同一个对象进行多次引用的例子。

幸运的是，PHP4 中存在强制按引用传递的方式，但是它需要使用一种看起来很笨的语法。

按引用赋值：

```
$other = & $my_obj;
// $other 和 $my_boj 指向相同对象
```
按引用传递：
```
function setSchool(& $school) 
{
    // $school现在是被传递对象的引用而不是副本    
}
```
按引用返回：
```
function & $getSchool()
{
   // 返回一个引用而不是副本
   return $this->school;
}
```
尽管这样也可以正常工作，但是程序员很容易忘记使用 `&` 符号，容易使 bug 蔓延到面向对象的代码中。而且这样的代码不会报错，加上导致错误的代码看上去好像还很合理，所以很难追踪到 bug。
这时 PHP 手册中不仅包括语法，还特别增加了对象方面的内容，并且面向对象的代码开始成为主流。对象在 PHP 中并非没有引起争论（显然现在还是这样），像 “我需要对象吗” 这样的论调在邮件列表中是很常见的。Zend 站点也将支持面向对象程序设计和其他持反对意见的文章放在了一起。

尽管按引用传递的观点存在争论，许多程序员还是在他们的代码中加入了 `&` 符号。面向对象的 PHP 逐渐流行。就像 `Zeev Suraski` 在 DevX.com 上写的一篇文章（[http://www.devx.com/webdev/Article/10007](http://www.devx.com/webdev/Article/10007)）中所说的那样：

PHP 历史上最大的一个进步就是对于面向对象编程的支持（尽管功能不多，还存在一些问题和限制），并且面向对象已成为最流行的开发方式。这个趋势，是我们没有预料到的。目前我们没有为 PHP 设计充足的面向对象开发功能，所以在这方面 PHP 显得不那么让人满意。现在 PHP 中的对象与其他面向对象语言中真正的对象不同，它更像是关联数组。

像第一章所说的那样，很多站点和在线文章开始对面向对象设计产生浓厚的兴趣。PHP 的官方代码库 PEAR 本身就使用了面向对象设计。在扩展 PHP 功能的 PEAR 代码包中，我们可以找到一些面向对象设计模式的最佳示例。

也许有人会认为 PHP 是迫于不可避免的外部压力才支持面向对象的。值得注意的是，虽然面向对象编程在 20 世界 60 年代就已经出现，但是从 20 世纪 90 年代中期才开始发展。最为流行的 Java 直到 1995 年才发布。面向过程的语言 C 的扩展版 C++ 则在 1979 年才开始出现。经过长时间的发展，C++ 在 20 世纪 90 年代有才了真正的飞跃。Perl 5 在 1994 年发布，新的变革使得这个曾经是面向过程的语言也支持了面向对象（虽然有些人认为 Perl 面向对象的支持是后来才想到的）。作为一个面向过程的小型语言，PHP 迅速地实现了面向对象的支持，这显示了 PHP 对用户需求的切实考虑。

#### 拥抱改变：PHP 5

PHP5 明确表示支持面向对象和面向对象程序设计。这并不是说对象现在是 PHP 唯一的工作方式（本书也没有这样说），但是现在对象被认为是开发企业级系统和强大助力和重要方法，并且 PHP 的核心设计也完全支持对象。

PHP 是一个支持面向对象开发的语言，而不是一种纯面向对象的语言。但 PHP 对于对象的支持程度，已经足以实现书中所介绍的所有面向对象设计的目标。

可以这么说，PHP5 中功能增强的显著影响便是大型互联网公司采用了这种语言，像 `Yahool!` 和 `Facebook` 都开始在他们的平台上广泛使用 PHP 。PHP5 已成为企业开发的之一。

对象已经从事后的想法变为 PHP 语言的驱动力。可能最重要的改变是默认按引用传递的行为代替了问题多多的对象赋值。但这只是一个开始。在本书中，尤其是这一部分，我们将会遇到更多的扩展和增强 PHP 对象支持的更多变化，包括参数指示（argument hinting）、私有（private）和保护（protected）类型的方法及属性、static关键字、命名空间、异常等。PHP5 已经存在了很长一段时间（约 12 年），很多重要的新特性也逐步发布。

例如 5.3 引入了命名空间。通过命名空间创建类和函数的命名作用域，在扩展系统或者包含类库时，你就可以在不同类库中使用名称相同的类，而不会产生冲突。命名空间还可以把你从使用复杂却必需的命名规范中拯救出来：
```
class megaquiz_util_Conf
{
    
}
```
> 这种命名方式被很多框架曾采用，如 Zend Framework、CakePHP。

像这样的类名可以防止包之间的冲突，但是会使代码显得不够简洁精炼。我们也看到了诸如对闭包（Closure）、生成器（Generator）、Trait 和 延迟静态绑定（late static bindings）的支持。


#### PHP 7：缩小差距

程序员对要求是高标准的。对于很多爱好设计模式的开发人员来说，PHP 有两个主要欠缺的特点就是 `标量类型声明` 和 `强制返回类型`。使用 PHP5 可以强制传递给函数或方法的参数类型，你只需要一个对象，数组，或回调函数即可，标量值（如整数、字符串和浮点数）根本无法执行。此外，如果你想声明一个方法或一个函数的返回类型，也完全没戏。

正如你所见，面向对象的设计通常将方法声明视为一种契约（contract）。该方法需要某些输入，相反地，它承诺给你一个特定类型的数据。

使用 PHP5 开发时，程序员被迫依靠注释、约定和手动类型检查来维护此类契约。开发人员总是抱怨这种情况。本书前一版的引用：

> ...仍然没有承诺提供对提示返回类型特性的支持。该特性可以在方法或函数声明中声明它返回的对象类型了。它会被 PHP 引擎强制实现。提示返回类型将进一步改进 PHP 对模式原则（例如 “针对接口编程，而不是针对实现编程”）的支持。我希望能在本书重印或再版时向大家介绍这一特性。

很高兴，这一天终于到了！PHP7 引入了标量类型声明(scalar type declarations)（之前称为类型提示 type hints）和返回类型声明。你将在这一版看到它们大量地使用。

PHP7 还提供了其他很不错的功能，包括匿名类和一些针对命名空间的加强。

#### 拥抱和疑虑：关于对象的争辩

对象和面向对象设计引起了两方阵营的热烈争辩。很多优秀的程序员这几年来开发了很多优秀的程序而并没有使用对象，而 PHP 将仍然是一个重要的面向过程的 Web 编程平台。

本书很自然地会偏向于面向对象，这代表我对面向对象的偏爱。因为本书就是关注对象和面向对象设计的，不可避免地强调面向对象。但要注意，本书绝对不是要说明对象才是 PHP 中唯一可以开发出成功代码的途径。

开发人员是否选择使用 PHP 作为面向对象语言，都是偏好的问题。事实上，使用函数和全局代码照样可以创建完美可接受的项目，一些伟大的项目（像WordPress）在其基础架构中仍然是过程式的。然而，如果不理解和使用 PHP 对对象的支持，就会越来越难以成为那些拥抱对象并且广泛实践的 PHP 程序员，尤其是你可能依赖的第三方库本身可能就是面向对象的。

不过，我们一开始就应该记住那个著名的 Perl 格言：做一件事有很多种方法（There's more than one way to do it）。对于小脚本来说尤其如此，很多时候让代码快速建立并执行比搭建一个良好的易于扩展的架构更为重要。在极限编程领域，我们将对这样项目的测试称为 spike。


代码是个很灵活东西。写代码的技巧在于：搞清楚什么时候你一时的想法会成为另一个更大的开发的源头，在确定设计方案之前暂停大量的代码编写工作。你可能决定使用面向对象的设计方案，希望本书能够帮助你开始构建面向对像的架构。


#### 小结
本章介绍了 PHP 语言中对象的背景。未来，PHP 将和面向对象设计紧密相连。在接下来的几章中，我将介绍目前 PHP 对于对象的支持及一些与设计相关的主题。
